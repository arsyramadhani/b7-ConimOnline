
@{
    ViewBag.Title = "Find Conim";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card card-body p-4 border-0 shadow mb-3">
    @*<div class="row">
            <h6>Cari:</h6>
        </div>*@
    <div class="row mb-1 ">
        <div class="col-lg-4 col-xl-4 mb-2">
            <select id="sel_dept" class="form-control form-control-sm ">
                @*<option>Support - IT</option>*@
            </select>
        </div>
        <div class="col-lg-4 col-xl-4 mb-2">
            <select id="sel_emp" class="form-control form-control-sm ">
            </select>
        </div>
        <div class="col-lg-4 col-xl-4 mb-2">
            <select id="sel_site" class="form-control form-control-sm ">
            </select>
        </div>
        <div class="col-lg-4 col-xl-4 mb-2">
            <select id="sel_kategori" class="form-control form-control-sm ">
            </select>
        </div>
        <div class="col-lg-4 col-xl-4 mb-2">
            <select id="sel_year" class="form-control form-control-sm ">
            </select>
        </div>
        <div class="col-lg-4 col-xl-4 mb-2">
            <select id="sel_status" class="form-control form-control-sm ">
            </select>
        </div>
    </div>
    <div class="row">
        <div>
            <button class="btn btn-sm btn-outline-success">Find</button> 
        </div>
    </div>

</div>

<div class="card card-body border-0 shadow table-wrapper table-responsive">
    <div class="mt-4"></div>
    <table id="tblConim" class="table table-hover">
        <thead>
            <tr>
                <th class="border-gray-200">Nomor</th>
                <th class="border-gray-200">Nama</th>
                <th class="border-gray-200">Departemen</th>
                <th class="border-gray-200">Site</th>
                <th class="border-gray-200">Kategori</th>
                <th class="border-gray-200">Judul</th>
                <th class="border-gray-200">Status</th>
                <th class="border-gray-200">Outstanding</th>
                <th class="border-gray-200">Tanggal Outstanding</th>
            </tr>
        </thead>
        <tbody> 
        </tbody>
    </table>
    <div class="card-footer px-3 border-0 d-flex flex-column flex-lg-row align-items-center justify-content-between">

    </div>
</div>
@section scripts{
    <script type="text/javascript">
        const DTO = {
            Department: null,
            NIK: null,
        }
        $(document).ready(function () {
            const table = $('#tblConim').DataTable({
                searching: false,
                "bSort": false,
                "dom": 'rtip'
            }) 

            // Load Department
            $.ajax({
                type: "POST",
                url: "/api/conim",
                data: JSON.stringify({
                    Option: "GET_DEPARTMENT"
                }),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (res) {
                    $('#sel_dept').select2({
                        placeholder: "Departemen",
                        data: res.map((val, i) => {
                            return {
                                id: i,
                                text: val.DEPARTMENT
                            }
                        }
                        )
                    }).val(null).trigger('change')
                },
                error: (err) => {
                    console.error(err)
                }
            });

            // Load Employee
            $.ajax({
                type: "POST",
                url: "/api/conim",
                data: JSON.stringify({
                    Option: "GET_EMPLOYEES"
                }),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (res) {
                    let result = res.map((val, i) => {
                        return {
                            id: val.nik,
                            text: val.username
                        }
                    }) 

                    $('#sel_emp').select2({
                        placeholder: "Karyawan",
                        data: result
                    }).val(null).trigger('change')
                },
                error: (err) => {
                    console.error(err)
                }
            });

            // Load Site
            $.ajax({
                type: "POST",
                url: "/api/conim",
                data: JSON.stringify({
                    Option: "GET_SITE"
                }),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (res) {
                    let result = res.map((val, i) => {
                        return {
                            id: val.Location,
                            text: val.Location
                        }
                    }) 

                    $('#sel_site').select2({
                        placeholder: "Site",
                        data: result
                    }).val(null).trigger('change')
                },
                error: (err) => {
                    console.error(err)
                }
            });

            // Load Type
            $.ajax({
                type: "POST",
                url: "/api/conim",
                data: JSON.stringify({
                    Option: "GET_TYPE"
                }),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (res) {
                    let result = res.map((val, i) => {
                        return {
                            id: val.type,
                            text: val.description
                        }
                    })

                    $('#sel_kategori').select2({
                        placeholder: "Kategori",
                        data: result
                    }).val(null).trigger('change')
                },
                error: (err) => {
                    console.error(err)
                }
            });

            // Get Year
            $.ajax({
                type: "POST",
                url: "/api/conim",
                data: JSON.stringify({
                    Option: "GET_YEAR"
                }),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (res) {
                    let result = res.map((val, i) => {
                        return {
                            id: val.CNM_Tahun,
                            text: val.CNM_Tahun
                        }
                    })

                    $('#sel_year').select2({
                        placeholder: "Tahun",
                        data: result
                    }).val(null).trigger('change')
                },
                error: (err) => {
                    console.error(err)
                }
            });

            // Get Status
            $.ajax({
                type: "POST",
                url: "/api/conim",
                data: JSON.stringify({
                    Option: "GET_STATUS"
                }),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (res) {
                    let result = res.map((val, i) => {
                        return {
                            id: val.ID,
                            text: val.STATUS
                        }
                    })

                    $('#sel_status').select2({
                        placeholder: "Status",
                        data: result
                    }).val(null).trigger('change')
                },
                error: (err) => {
                    console.error(err)
                }
            });


            $('#sel_dept').on('select2:select', function (e) {
                DTO.Department = e.params.data.text
            });
            $('#sel_emp').on('select2:select', function (e) {
                DTO.NIK = e.params.data.id
            });
        });


    </script>    
}

@*@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            if (initialize()) {
                getLaporan()
            }
        });

        const initialize = () => {
            $('#tblConim').DataTable({
                "lengthChange": false,
                "searching": false,
                "ordering": false
            });

            $('#sel_dept').select2({
                placeholder: "Departemen"
            });
            $('#sel_emp').select2({
                placeholder: "Nama Karyawan"
            });
            $('#sel_site').select2({
                placeholder: "Site",

            });
            $('#sel_kategori').select2({
                placeholder: "Kategori",
                minimumResultsForSearch: Infinity
            });
            $('#sel_year').select2({
                placeholder: "Tahun"
            });
            $('#sel_status').select2({
                placeholder: "Status",
                minimumResultsForSearch: Infinity
            });

            return true
        }





    </script>

}*@

@*@section scripts{

    <script type="text/javascript">

        $(document).ready(function () {
            if (initialize()) {
                getLaporan()
            }
        });

           

            //const getLaporan = () => {
            //    return $.ajax({
            //        dataType: "json",
            //        contentType: 'application/json; charset=utf-8',
            //        type: "POST",
            //        url: "/Conim",
            //        data: JSON.stringify({
            //            Option: "GET_LAPORAN"
            //        }),
            //        success: function (response) {
            //            let res = JSON.parse(response)
            //            console.log(res)
            //            return JSON.parse(response)
            //        }
            //    });
            //}
</script>

}*@